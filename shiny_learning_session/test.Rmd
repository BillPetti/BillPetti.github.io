---
title: "Decision Sciences Learning Session"
subtitle: "Interactive Apps with R Shiny"
author: "Bill Petti"
institute: "Maritz Motivation"
date: "2020-06-22"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

background-image: url(https://rstudio.com/assets/img/og/shiny-og-twitter.jpg)

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)

library(knitr)
```

---
# Agenda

- Walk through Shiny basics


- View more complex Shiny apps


- Live changes to a Shiny app

---
# What is Shiny?

--


```{r, out.height='110%', out.width='110%', fig.align='center', echo=F}

knitr::include_graphics('gold_jerry_gold.gif')
```
---
# What is Shiny (more helpful edition)?

--

- Shiny is an R library that makes it very easy to build interactrive web applications without the need to directly code in JavaScript

--

- You can build an application completely using R, or layer in custom CSS, HTML, or JavaScript

--

- Apps can be run locally on your machine, deployed to shinyapps.io, or deployed to our own Shiny server for greater security 

---
# What is Shiny (more helpful edition)?

--

- Anything that you can code in R can be displayed and integrated into a Shiny app

--

- Tables, plots, downloading data, uploading data, transforming data

--

```{r, fig.align='center', echo=F}

knitr::include_graphics('everything.gif')
```

---
class: inverse, center, middle

# Building your first Shiny app

---

# First Shiny App

Within RStudio, click File -> New File -> Shiny Web App

```{r, fig.align='center', echo=F}

knitr::include_graphics('new_shiny_app.png')
```

---
# First Shiny App

- The file will provide a skeleton or template for fleshing out your app
- The file has two main parts
  - `ui`: This is where you code the user interface elements (what users see, interact with)
  - `server`: This is where you code the action and outputs of the app

```{r, out.height='60%', out.width='60%', fig.align='center', echo=F}

knitr::include_graphics('skeleton_shiny_app.png')
```

---
# First Shiny App

- This app allows users to adjust the bin size when plotting a histogram of the faithful waiting variable
- To run the app, click Run App in the upper right-hand corner of the app file
```{r, fig.align='center', echo=F}

knitr::include_graphics('first_shiny_app.png')
```
---
# Uses of Shiny

Shiny can be used for a number of broad needs:

- Display data or a simple plot without interactivity
- Display data with some interactivity (i.e. filtering, sorting)
- Generate different plots based on some interactivity
- Combine plots and tabular data
- Lots of other stuff...

Let's walk through examples of each of the examples above...

---
class: inverse, center, middle

# Apps that display plots and data

---
#app_plot.R

.pull-left[

```{r, fig.align='center', echo=F}

knitr::include_graphics('plot_app.png')
```
]

.pull-right[
```{r, fig.align='center', echo=F}

knitr::include_graphics('app_plot_code.png')
```

]

---
#app_datatable.R

.pull-left[

```{r, fig.align='center', echo=F}

knitr::include_graphics('app_datatable.png')
```
]

.pull-right[
```{r, fig.align='center', echo=F}

knitr::include_graphics('app_datatable_code.png')
```

]

---
#app_combine_outputs.R

.pull-left[

```{r, fig.align='center', echo=F}

knitr::include_graphics('app_combine.png')
```
]

.pull-right[
```{r, fig.align='center', echo=F}

knitr::include_graphics('app_combine_code.png')
```

]

---
class: inverse, center, middle

# Apps that allow for user action

---
#app_action.R

.pull-left[

```{r, fig.align='center', echo=F}

knitr::include_graphics('app_action.png')
```
]

.pull-right[
```{r, fig.align='center', echo=F}

knitr::include_graphics('app_action_code.png')
```

]

---
class: inverse, center, middle

# Inputs

---
#Inputs

- Most of the useful interactivity in Shiny is based on inputs.
- Inputs are typically generated through the `ui` and send information to the `server` so that some kind of actoin can take place
- The most common inputs are widgets that allow you to filter data (honestly, filtering data is about 90% of what you will use inputs for)

---
#Inputs

- Here, we can filter the `faithful` data set by the length of the eruptions before binning and plotting


.pull-left[

- We filter the data based on the same action button, and then use that filtered data set for binning and plotting (notice once you make an objection reactive it needs to be followed by `()` for the server to recognize it)

```{r, fig.align='center', echo=F}
  
knitr::include_graphics('app_action_input.png')
```

]

.pull-right[
```{r, out.height='75%', out.width='75%', fig.align='center', echo=F}

knitr::include_graphics('app_action_input_code.png')
```

]

---
#Inputs

There are lots of different inputs you can use:

```{r, out.height='75%', out.width='75%', fig.align='center', echo=F}

knitr::include_graphics('types_of_inputs.png')
```

---
#Conditional Inputs

- Sometimes you might want the available values for inputs to be conditional on selections from earlier filters
- Consider an [app that displays data about MLB games](https://billpetti.shinyapps.io/live_pbp_viewer/)
  - The users first selects a date from a calendar input
  - Then user can select from a list of games available on that day
- Conditional Inputs can be useful in a few ways
  - Too many potential options for a drop down
  - Save users from themselves (prevent them from selecting options that may not make sense)

---
# Conditional Inputs

First, we create the calendar input in the `ui` section and create a `uiOutput` that will reference an object from the `server` names `matchup`

```{r, eval=F}
ui <- fluidPage(

  # Application title
  titlePanel("Conditional Filters"),

  dateInput("date",
            "Choose or enter a date (YYYY-MM-DD)",
            value = '2019-04-01'),
  uiOutput('matchups')

)
```

---
# Conditional Inputs

Then, we render the ui `matchups` server-side, which can then be referenced in the `ui` by `uiOutput`

```{r, eval=F}
server <- function(input, output) {

  output$matchups <- renderUI({

    games <- get_game_pks_mlb(input$date) %>%
      mutate(matchup =
               paste0(teams.away.team.name, " at ",
                      teams.home.team.name))

    matchups <- games %>%
      pull(matchup)

    selectizeInput("matchups_for_date",
                   "Select a game",
                   matchups,
                   width = 350)
  })
}
```

---
# Conditional Inputs

.pull-left[
```{r, out.width = "900px", fig.align='center',  echo=F}

knitr::include_graphics('app_conditional_input_1.png')
```
]
.pull-right[
```{r, out.width = "250px", fig.align='center', echo=F}

knitr::include_graphics('app_conditional_inputs_2.png')
```
]

---
class: inverse, center, middle

# Downloading data and plots from Apps

---
#Downloading Data and Plots

- You can allow users to download data or plots by using the `downloadButton()` function

.pull-left[
```{r, fig.align='center', echo=F}

knitr::include_graphics('app_download.png')
```
]

.pull-right[
```{r, out.height='75%', out.width='75%', fig.align='center', echo=F}

knitr::include_graphics('app_download_code.png')
```

]

---
#Downloading Data and Plots

- It's a little different for `csv` files

.pull-left[
```{r, fig.align='center', echo=F}

knitr::include_graphics('app_download_data.png')
```
]

.pull-right[
```{r, out.height='75%', out.width='75%', fig.align='center', echo=F}

knitr::include_graphics('app_download_data_code.png')
```

]
---

class: inverse, center, middle

# Tabbed UI Design

---
# Tabbed UI

- You can add more functionality into your apps by adding tabs
--

- Each tab can be tied to universal filters/inputs or you can separate filters/inputs that apply to that tab only
--

- To create a tabbed app you use the following in the `ui` section:

```
 ui <- fluidPage(
 
  titlePanel("Old Faithful Geyser Data"),

  tabsetPanel(
    tabPanel('plot',
        plotOutput("faithful_plot")),
    tabPanel('table',
        DTOutput('faithful_data'))

  )
)
```
---
# Tabbed UI 

.pull-left[
```{r, out.width = "900px", fig.align='center',  echo=F}

knitr::include_graphics('app_tab_1.png')
```
]


.pull-right[
```{r, out.width = "900px", fig.align='center',  echo=F}

knitr::include_graphics('app_tab_2.png')
```
]

---
class: inverse, center, middle
# More Complex Shiny Apps

---
**COVID-19 Auto Trends**: https://maritzmotivation.shinyapps.io/auto_covid_19_trends/
- Tabbed, `navbarPage`, html and automated narratives based on selection

```{r, fig.align='center',  echo=F}

knitr::include_graphics('auto_covid_app.png')
```

---
**MM Culture Health App**: https://maritzmotivation.shinyapps.io/mm_culture_health_app/
- Tabbed, downloading plots, global and local filters/inputs, conditional filters, custom html

```{r, out.width = "900px", fig.align='center',  echo=F}

knitr::include_graphics('culture_health_app.png')
```

---
**Can I Make the Game?**: https://billpetti.shinyapps.io/can_i_make_the_game/
- Data upload, Google API, downloading data

```{r, out.width = "900px", fig.align='center',  echo=F}

knitr::include_graphics('can_i_make_app.png')
```
---

class: inverse, center, middle

# Let's build an app together!
